# ISP

회사의 구조도 가정과 다르지 않습니다. 라우터를 이용한다는 특성은 같습니다. 다만 거리가 멀며, 라우팅테이블에 내용이 어마어마해 수동으로 관리해주어야 합니다.

### 엑세스 회선

액세스 회선은 가정, 회사의 LAN과 인터넷을 연결하는 선을 말합니다. 즉 서브넷을 ISP의 인터넷과 연결시켜주는 선을 말합니다. 

보통의 경우 액세스 회선을 ADSL(asymmetric digital subscriber), FTTH(fiber to the home)(전용선), 전화회선, ISDN등을 이용합니다. 

### ADSL

예시로 ADAL 을 살펴보면 일반 사용자에서 넘어갓 패킷은 인터넷 접속용 라우터에 도착하게 되고 ADSL모뎀 등을 통해 ISP에 도착하게 됩니다. 

즉 사용자의 라우터 -> 인터넷 접속용 라우터 -> ADSL모뎀 ->  ISP입니다.

#### 인터넷 접속용 라우터

일반 라우터와 크게 다르지는 않지만, 이더넷 헤더가 조금 다릅니다. 기존의 경우 MAC헤더를 지우고 경로표를 통해 다시 MAC헤더를 붙인 뒤 다음 라우터로 송신하는 과정을 거쳤습니다. 하지만 여기서는 MAC, PPPoE, PPP(Point to Point Protocol)의 세개의 헤더가 붙게 됩니다.

#### ADSL모뎀

여기서는 받아온 패킷을 작게 분해해서 셀에 저장합니다. 이 작게 나눠진 셀은 ATM이라는 통신 기술에 사용합니다. ATM은 (Asynchronous Transfer Mode)전화회선에 기초한 통신방식이라고 생각하면 됩니다. TCP와 같은 방식인데 예전에 흥행하던 기술입니다. 최근의경우 셀로 분할하지 않는 경우도 많습니다.

이제 셀을 전기 신호로 변경하는 작업을 합니다. LAN의 경우 단순하게 0, 1을 위 아래로 구분하여 직각의 사각형이 나오도록 신호를 보냈습니다. 그 과정에서 파형이 변형되면 곡선을 가졌습니다.  하지만 멀리 가야하기 때문에 완만한 파형(정현파)을 합성한 곡선의 파형을 만들어 보냅니다. 이 경우 파형의 변형이 줄어들어 잡음의 영향이 줄어들게 됩니다. 이렇게 변형하는 기술을 변조 기술이라고 합니다. ADSL은 진폭변조와 위상변조를 결합한 직교 진폭 변조라는 방식을 사용합니다.

##### 진폭변조

신호의 진폭의 크기에 0과 1을 대응시키는 방식입니다. 즉 1이면 진폭을 크게, 0이면 보통으로 만듭니다. 기존의 사각이 아니라 파형의 진폭을 변경하여 1과 0을 구분하게 됩니다. 이 방법은 진폭에 따라 비트 수를 늘릴 수 도 있습니다. 비트 수를 늘리게 되면 한 신호에 더 많은 데이터를 담을 수 있게 되어 속도 향상이 있지만 그만큼 오류의 가능성도 많아집니다.

##### 위상변조

위상변조는 신호의 위상에 0과 1을 대응시키는 방법입니다. 파형을 쪼개 시작지점이 0도이면 0, 180도이면 1로 구분하는 방식입니다. 이 역시 각도의 간계를 나누어 고속화가 가능하지만 오류의 가능성이 늘어납니다.

ADSL의 경우 이 두 가지를 결합하여 사용합니다. 진폭과 위상에 각각 1비트씩 부여합니다.(0, 1, 0, 1) 따라서 한 진폭에 2 비트를 부여할 수 있습니다. 

예를들어 진폭이 1이고 위상이 0이면 10, 그 반대의 경우 01 이런식으로 말입니다.  결과적으로 한 파동에 00 01 10 11 총 4가지 경우의 수가 나오는 2비트를 표현할 수 있게 됩니다. 기존의 1비트에서 두배나 늘어났습니다. 

##### 고속화

ADSL은 주파수를 여러개 사용하여 고속화를 실현합니다. 변조의 기술로 속도를 높이는 것은 한계가 있기 때문에 주파수를 여러개 합성하여 사용합니다. 4.3125kHz씩 주파수를 다르게하여 수백개의 파를 사용하게 됩니다. 구체적으로는 여기서도 잡음이 없는파에서는 변조를 쪼개서 여러개를 대응시켜 효율을 극대화 합니다.

####스플리터

ADSL모뎀을 떠나면 스플리터라는 장치에 들어갑니다. ADSL신호는 전화신호와 함께 나가는데 송출의 경우 스플리터는 하는일이 없습니다. 반대로 전화 회선에서 수신신호가 들어올 경우 전화와 ADSL의 신호를 나누는 역할을 합니다.

####스플리터 이후

스플리터를 떠나면 IDF나 MDF로 갑니다. 전자는 중간배선반, 후자는 주 배선반입니다. 큰 건물의 배선반이고 이곳을 거친 뒤 보안기(낙뢰등을 막기위한 퓨즈가 있음)를 거친 뒤 전봇대의 전화케이블로 가게됩니다. 이 케이블을 통해 전화국으로 가게됩니다.

### 전화국

#### DSALM

전화국에 도착한 신호가 역순서대로 배선반, 스플리터를 거치면 DSALM이라는 곳에 도착합니다. 여기서 전기신호를 셀로 복원하게 됩니다. DSLAM은 다수의 ADSL을 묶어놓은 장치입니다. 이곳은 이더넷 통신을 사용하지는 않고 ATM만 사용합니다. 최근의 ATM을 사용하지 않는곳은 바로 뒤의 라우터로 가게 됩니다.

#### BAS

ATM셀로 변경된 데이터는 BAS(광대역 엑세스 서버)로 오겓됩니다. 여기서 셀을 합쳐서 패킷으로 되돌리게 됩니다. 인터넷 접속용 라우터에서 MAC, PPPoE, PPP헤더를 붙였는데 여기서 PPP헤더만 남기고 지웁니다. 그런 뒤 터널링용 헤더를 붙여 (L2TP) 터널링으로 보내고 프로바이더측 전화국으로 보내게됩니다. 이 프로바이더 측에서는 이제 인터넷에 패킷을 보내게 됩니다.