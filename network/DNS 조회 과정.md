# DNS조회 과정

브라우저가 URL을 해석한 뒤 이를 DNS 서버에 보내 IP주소를 의뢰하게 된다. 그런데 사실 이를 브라우저가 하는 것이 아니다.

## Socket Library

### resolver

URL로 DNS서버에게 IP주소를 조회한다. 라는 것은 결국 DNS를 서버로 본 뒤 request를 보내고 response를 받는 과정이다. 이것을 DNS 서버에 대해 클라이언트로 동작한다고 말할 수 있다. 이 때 DNS 클라이언트에 해당하는 것을 DNS리졸버(이하 리졸버)라고 한다. 

정리하자면 리졸버와 DNS가 클라이언트-서버 구조로 URL로 request를 보내고 IP로 response를 받는 것이다.

이 과정을 Name Resolution이라고 한다. 그래서 리졸버(resolver)다.

### socket

그러면 리졸버는 어디서 나온 애일까? 바로 소켓 라이브러리에 있는 프로그램이다. socket 라이브러리란 OS에 포함되어 있는 네트워크의 기능을 애플리케이션에서 호출하기 위한 라이브러리입니다. 즉 라이브러리를 호출하여 그 안에 있는 리졸버를 작동시켜 Name Resolution을 합니다.

###리졸버의 동작

`변수명 = gethostbyname("www.jinseong.com")` 과 같이 애플리케이션에서 호출하면 제어가 리졸버로 넘어가게 된다. 이제 리졸버는 DNS서버에 request를 보내기 위한 메시지를 만든다.이는 HTTP의 request message와 유사하다. 메시지를 다 만들면 이제 DNS서버에 의뢰하게 되는데 이 때는 리졸버가 직접하지 않는다. 그 이유는 socket의 정의를 보면 알 수 있다. 바로 위에서 소켓 라이브러리란 OS에 포함된 네트워크 기능을 호출하는 라이브러리라고 했다. 즉 OS를 부르게 된다. 

### 프로토콜 스택

OS의 프로토콜 스택을 호출하여 의뢰하게 된다. 브라우저가 DNS서버에 직접 접근하지 않고 의뢰하듯 리졸버도 의뢰하는 것이다. 프로토콜 스택은 OS에 내장된 네트워크 제어용 소프트웨어로 프로토콜 드라이버, TCP/IP 소프트웨어 로도 불린다.

이제 제어가 프로토콜 스택으로 넘어가고 프로토콜 스택은 LAN 어댑터를 통해 DNS서버에게 의뢰한다.  정리하자면

> 브라우저 (URL해석) -> socket(라이브러리) -> resolver(소켓에 들어있는 프로그램으로 메시지 작성) -> 프로토콜 스택(실제로 보냄)

의  과정을 거치게 된다. DNS서버는 내부적으로 IP조회를 한 뒤 이를 응답하고 보낸 역방향으로 웹 브라우저에게 IP를 전달한다.

그렇다면 프로토콜 스택이 의뢰를 보낼 때 DNS서버의 IP주소도 필요할텐데 이는 TCP/IP설정에서 바꿀 수 있다.

## IP주소

xx동 xx번지로 표현한다. 이 때 동은 네트워크 번호, 번지는 호스트 번호라고 한다.  이 네트워크번호 + 호스트번호를 IP주소라고한다.

보통 `10.11.12.13`이렇게 표기한다. IP주소의 규칙은 두가지를 합쳐서 32비트로 표현한다만 결정되어 있을 뿐 어느것이 네트워크고 어느것이 호스트인지는 모릅니다.

그래서 이 정보를 필요에 따라 IP주소에 덧붙이기도 하는데 이를 '넷마스크'라고 합니다.

`10.11.12.13/255.255.255.0` 이렇게 사용하면 / 뒤의 내용이 넷마스크가 됩니다. 2진수로 고쳤을때 넷마스크가 1인부분은 네트워크 번호이며 0인부분은 호스트 번호를 나타냅니다.

`10     .11      .12       .13`

`11111111.11111111.11111111.00000000` (255.255.255.0의 2진수표기방법)

이렇게 되어 `10.11.12.13`의 IP주소는 10.11.12가 네트워크번호, 13이 호스트번호가 됩니다.

그런데 매번 저렇게 길게 표기하면 매우 귀찮아서 `255.255.255.0`을 그냥 10진수로 표기하기도 합니다. `10.11.12.13/24` 이렇게말입니다.

마지막으로 호스트번호의 특별한 의미를 가진 두 친구가있는데 0 과 1입니다. 호스트번호가 모두 0이면 IP주소는 각각의 기기가 아니라 서브넷(xx시 xx번지 xx동이라고 봤을 때 시에 해당함 즉 일반 기기보다는 더 큰 sub network) 을 의미하고, 1의경우 서브넷에 있는 기기 전체에 패킷을 보내는 브로드캐스트를 나타냅니다.

#### 참고자료

성공과 실패를 결정하는 1%의 네트워크원리, Tcutomu Tone, 이도희 옮김, 성안당