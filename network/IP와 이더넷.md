# IP와 이더넷

## 선행 지식

### 패킷의 기본

패킷은 기본적으로 헤더 + 데이터로 구성 되어있다. IP 담당 부분을 지나 LAN을 타고 패킷은 중계장치로 넘어간다. 이 중계장치에는 라우터와 허브가 있다. 이 중계장치들에는 수신처가 어느 방향으로 가야한다는 표가 있다. 이 표를 경로표 혹은 라우팅 테이블이라고 한다.

서브넷은 기본적으로 허브와 각각의 기기들이 연결되어있고 이 서브넷을 연결하는 것이 라우터다. 즉 서브넷 - 라우터 - 서브넷의 구조다. 그래서 라우터를 통해 다른 서브넷으로 갈 수 있다. 라우터에 있는 경로표와 수신처를 비교해서 다음 라우터를 찾아 넘어가면 서브넷을 이동하게 된다.

라우터와 서브넷 사이에는 허브가 있다. 즉 (허브 -> 라우터)(서브넷1) -> (허브 -> 라우터)(서브넷2)의 형태를 가진다. 이 허브는 라우터까지 운반해주는 역할을 한다. 라우터는 다음 라우터를 검색하고 그 사이에 허브가 껴있어서 허브가 라우터까지 데려다주는 방식이다.

* 라우터 : 목적지를 확인하여 다음 라우터를 알려준다. IP가 목적지를 확인하여 다음 IP중계장치를 나타낸다. IP 헤더를 사용한다.
* 허브 : 허브가 서브넷 안에서 퍀킷을 운반하여 다음 라우터까지 운반한다. 서브넷 안에 있는 이더넷이 중계장치까지 패킷을 운반한다. MAC헤더를 사용한다.

IP헤더와 MAC헤더 중 IP헤더는 수신처의 목적지다. 즉 서버의 주소를 가진다. MAC헤더는 바로 다음 라우터다. 그래서 계속 바뀐다. 

정리하자면 IP담당을 거쳐 LAN선을 탄 패킷은 클라이언트 -> 허브 -> 라우터 -> 허브 -> 라우터 -> 허브 .... 의 과정으로 도착하게 된다.

## IP 담당

IP담당 부분은  사실 크게 하는일은 없다. 이미 TCP에서 많은 일을 거친 패킷은 IP담당으로 넘어오게 된다. 그럼 IP담당에선느 IP헤더와 MAC헤더를 붙인다.

* IP 헤더 : IP주소로 표싣된 목적지 까지의 주소의 제어정보를 기록
* MAC 헤더: 이더넷 등 LAN을 사용하여 가장 가까운 라우터까지 패킷을 운반할 때 사용하는 제어 정보를 기록

이 차이가 있다. 선행지식이 있다면 라우터의 개념이 눈에 들어올 것이다. 이게 IP담당의 역할이다.

이를 이제 네트워크용 하드웨어(이더넷, 무선 LAN 등)에게 전달하면 디지털 데이터가 전기나 빛 신호로 변경되게 된다. 이 하드웨어들이 하는 역할은 이게 거의 다다.

### IP헤더

IP헤더에는 버전, 헤더 길이, 생존기간, 프로토콜 번호(TCP, UDP, ICMP...), 송신처 IP주소, 수신처 IP주소와 같은 것들이 기록된다.그런데 딱히 하는 역할은 없고 TCP에서 넘겨준 IP주소를 그대로 기록하게 된다. 그런데 송신처 IP주소는 LAN어댑터가 하나라면 주소가 하나겠지만 복수의 경우는 조금 복잡하다.