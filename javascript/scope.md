# Scope



특정 장소에 변수를 저장하고 나중에 그 변수를 찾기 위해 정의된 규칙을 스코프라고 한다.

## 컴파일러

자바스크립트는 흔히 동적언어 또는 인터프리터 언어로 분류한다. 하지만 사실 자바스크립트는 컴파일러 언어다. 굉장히 놀랍지만 자바스크립트 엔진은 컴파일러가 하는 일을 처리한다. 전통적인 컴파일러는 소스가 실행되기 전에 3단계를 거치는데 이를 Compilation이라고 한다.

### Tokenizing / Lexing

문자열을 나누어 토큰이라는 조각으로 만드는 과정이다. 예를 들어 `var a = 2;`라는 구문을 보면 이를 var, a, =, 2, ; 이렇게 나누는 것이다. 빈칸의 의미가 있다면 토큰이되고 없다면 토큰이 되지 않는다.

*토크나이징과 렉싱은 미묘한 차이가 있다.* 토큰을 인식할 때 무상태 방식으로 하는지 상태 유지 방직으로 하는지에 따라 구분된다. 이 말이 무엇이냐면 토크나이저가 상태유지파싱 규칙을 적용해 a가 별개의 토큰인지, 다른 토큰의 일부인지를 파악한다면 렉싱이다.

아직은 무슨소린지 잘 모르겠다.

### Parsing

파싱은 나누어진 토큰 배열을 프로그램 문법 구조에 따라 중첩 원소를 갖는 *트리 형태*로 바꾸는 과정이다. 이 트리를 AST(Abstract Syntax Tree)라고 부른다. 

var a = 2;는 먼저 변수선언이라는 최상위 노드에서 시작하고, Identifier와 Assignment Expression이라 부르는 자식노드를 가진다. 전자는 a, 후자는 2라는 값이 들어가게 된다.

### Code-Generation

위에서 만들어진 AST를 실행 코드로 바꾸는 과정이다. AST를 기계어 집합으로 바꿔 실제로 a라는 변수를 생성하고 할당하는 작업이다.

중요한 것은 자바스크립트가 실행되려면 실행 거의 바로 직전에 컴파일 되어 실행된다는 점이다.

## 스코프의 이해

프로그램이 실행 될 때 세 곳의 역할이 중요하다.

* 엔진 : 컴파일레이션의 시작부터 끝까지와, 실행을 책임진다.
* 컴파일러 : 엔진의 친구로, 파싱과 코드 생성을 한다.
* 스코프 : 엔진의 친구로, 선언된 모든 변수 검색 목록을 작성하고 유지한다.

### 검색

`var a = 2;`라는 코드를 코드 생성과정에 들어간다면 컴파일러가 가장 먼저 할 일은 무엇일까? 바로 변수 a가 선언된 적이 있는지를 검색하게 된다. 이에 LHS 검색과 RHS검색이 있다.짐작하겠지만 Left Hand Side, Right Hand Side다. 이는 대입연산의 방향을 의미한다.

쉽게`=`연산자를 기준으로 왼쪽과 오른쪽을 다르게 검사한다는 의미에서 만들어진듯 하다. 엄밀하게는 RHS는 특정 변수의 값만 찾는다. 이에비해 LHS는 변수 컨테이너가 존재하는지를 찾는다. 예를 들어보자.

```javascript
var a = 0;
var b = a;
```

이 경우 첫번째 줄에서 a를 찾을 땐 LHS다. 두번째 줄에서 b를 찾을 때도 LHS다. 마지막으로 두번째 줄에서 a를 찾을 때는 RHS를 사용한다. 변수의 값만 가져오는 것이다.

```javascript
console.log(a);
a = 2;
```

이 경우는 어떨까? 첫번째 줄의 a는 RHS 검색을 수행한다. 두번째 줄의 a는 LHS를 수행한다. 변수의 값과 관계없이 컨테이너에 접근해 2를 대입한다.

```javascript
function foo(a){
  console.log(a);
}

foo(2);
```

1. foo()라는 함수를 호출하면 RHS 참조를 사용한다. 
2. foo()함수가 실행되고 파라미터 자리에 위치한 a라는 변수가 있는지 LHS
3. 2를 대입하고
4. console객체를 RHS검색
5. log메서드가 있는지 확인
6. a를 RHS해서 2라는 값을 받아와 파라미터로 넘겨 log() 호출

의 과정을 거치게 된다.





